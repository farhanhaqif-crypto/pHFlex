<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>pHFLEX WebAR</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">

    <!-- A-Frame & AR.js -->
    <script src="https://aframe.io/releases/1.4.1/aframe.min.js"></script>
    <script src="https://cdn.rawgit.com/jeromeetienne/AR.js/2.2.1/aframe/build/aframe-ar.js"></script>

    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-database-compat.js"></script>

    <style>
      body { margin: 0; overflow: hidden; }
    </style>
  </head>

  <body>
    <a-scene embedded arjs>
      <!-- Marker (using built-in Hiro marker) -->
      <a-marker preset="hiro">

        <!-- Liquid block representing pH color -->
        <a-box id="liquid" position="0 0.1 0" color="#33ff77" depth="0.1" height="0.2" width="0.1"></a-box>

        <!-- Display current pH value -->
        <a-entity id="phText"
          position="0 0.5 0"
          text="value: pH: --; align:center; width: 2; color: white">
        </a-entity>

        <!-- Educational note -->
        <a-entity id="noteText"
          position="0 -0.5 0"
          text="value: Waiting for data...; align:center; width: 2; color: yellow">
        </a-entity>

      </a-marker>

      <!-- Camera -->
      <a-entity camera></a-entity>
    </a-scene>

    <script>
      // === Firebase Configuration ===
      const firebaseConfig = {
        apiKey: "AIzaSyDKhPXV8oFJNVYJUNpIE09MRBtR_jl-tmU",
        authDomain: "phflex-48cfa.firebaseapp.com",
        databaseURL: "https://phflex-48cfa-default-rtdb.asia-southeast1.firebasedatabase.app",
        projectId: "phflex-48cfa",
        storageBucket: "phflex-48cfa.firebasestorage.app",
        messagingSenderId: "1019182703407",
        appId: "1:1019182703407:web:6e1c5834f611208c59f7da",
        measurementId: "G-80XN89H5P1"
      };

      // === Initialize Firebase ===
      firebase.initializeApp(firebaseConfig);
      const db = firebase.database();

      const phText = document.querySelector('#phText');
      const liquid = document.querySelector('#liquid');
      const noteText = document.querySelector('#noteText');

      // === Listen for pH changes in Firebase ===
      db.ref('/pHFLEX/currentValue').on('value', (snapshot) => {
        const value = snapshot.val();

        if (value === null) {
          phText.setAttribute('text', 'value', 'No data from Firebase');
          return;
        }

        const pH = parseFloat(value);
        phText.setAttribute('text', 'value', 'Current pH = ' + pH.toFixed(2));

        // === Change color based on pH ===
        let color = "#33ff77";  // default neutral
        if (pH < 7) color = "#ff3333";    // acidic = red
        if (pH > 7) color = "#3388ff";    // basic = blue
        liquid.setAttribute('color', color);

        // === Educational notes ===
        let note = "";
        if (pH < 3) note = "Strong Acid ⚗️ — Handle with care!";
        else if (pH < 7) note = "Acidic — Can corrode metals.";
        else if (pH === 7) note = "Neutral — Pure water.";
        else if (pH < 11) note = "Basic — Mild alkali (soap).";
        else note = "Strong Base 🧪 — Highly reactive!";
        noteText.setAttribute('text', 'value', note);
      });
    </script>
  </body>
</html>
